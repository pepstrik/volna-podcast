name: Update Transcripts Index

on:
  schedule:
    - cron: '0 11 * * *'  # 11:00 UTC = 14:00 –ú–°–ö
  
  workflow_dispatch:

jobs:
  update-transcripts:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Fetch from Google Apps Script
        run: |
          echo "üì• –ó–∞–≥—Ä—É–∂–∞—é –∏–Ω–¥–µ–∫—Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–æ–∫..."
          curl -s "${{ secrets.GOOGLE_APPS_SCRIPT_URL }}" -o transcriptions-index.json
          
          echo "üìä –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:"
          ls -lh transcriptions-index.json
          
          echo "üìã –ü–µ—Ä–≤—ã–µ 300 —Å–∏–º–≤–æ–ª–æ–≤:"
          head -c 300 transcriptions-index.json
          echo ""
      
      - name: Commit if changed
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          
          if git diff --quiet transcriptions-index.json 2>/dev/null; then
            echo "‚ÑπÔ∏è –§–∞–π–ª –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è"
          else
            echo "‚úÖ –ö–æ–º–º–∏—Ç—é –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
            git add transcriptions-index.json
            git commit -m "ü§ñ Auto-update transcripts from Google Drive"
            git push
          fi
      
      - name: Upload to GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: .
          publish_branch: gh-pages
