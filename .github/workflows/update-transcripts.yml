name: Update Transcripts Index

on:
  schedule:
    - cron: '0 11 * * *'
  
  workflow_dispatch:

jobs:
  update-transcripts:
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Fetch from Google Apps Script
        run: |
          echo "üì• –ó–∞–≥—Ä—É–∂–∞—é –∏–Ω–¥–µ–∫—Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–æ–∫..."
          curl -s "${{ secrets.GOOGLE_APPS_SCRIPT_URL }}" > transcriptions-index.json
          
          echo "üìä –ü—Ä–æ–≤–µ—Ä—è—é —Ä–∞–∑–º–µ—Ä:"
          ls -lh transcriptions-index.json
          
          echo "üìã –ü–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤:"
          head -c 200 transcriptions-index.json
          echo ""
          echo ""
      
      - name: Commit and push if changed
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
          if [ ! -s transcriptions-index.json ]; then
            echo "‚ùå –§–∞–π–ª –ø—É—Å—Ç!"
            exit 1
          fi
          
          if git diff --quiet transcriptions-index.json 2>/dev/null; then
            echo "‚ÑπÔ∏è –§–∞–π–ª –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è"
          else
            echo "‚úÖ –§–∞–π–ª –∏–∑–º–µ–Ω–∏–ª—Å—è, –∫–æ–º–º–∏—Ç—é..."
            git add transcriptions-index.json
            git commit -m "ü§ñ Auto-update transcripts from Google Drive"
            git push origin main
            echo "‚úÖ –£—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—à–µ–Ω–æ!"
          fi
